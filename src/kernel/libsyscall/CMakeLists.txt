project(libsyscall)

cmake_minimum_required(VERSION 2.4.0)

enable_language(C ASM)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=c99 -nostdinc")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/wrappers")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/mach")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../iokit")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/os")
include_directories("${DARLING_TOP_DIRECTORY}/platform-include")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../../libc/include")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../../duct/include")
include_directories("${CMAKE_CURRENT_SOURCE_DIR}/wrappers/libproc")
include_directories("${CMAKE_CURRENT_BINARY_DIR}")
add_definitions(-DPRIVATE=1 -D__DARWIN_C_LEVEL=20150101)
add_definitions('-D__XNU_PRIVATE_EXTERN=')
#add_definitions(-DKERNEL)

if (NOT ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")
	add_definitions(-DNO_SYSCALL_LEGACY)
endif (NOT ${CMAKE_SYSTEM_PROCESSOR} STREQUAL "i686")

set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -nostdlib -Wl,--version-script=${DARLING_TOP_DIRECTORY}/darwin.map")

set(MIG_USER_HEADER_SUFFIX "_internal.h")
mig(mach/exc.defs)
mig(mach/host_priv.defs)
mig(mach/host_security.defs)
mig(mach/ledger.defs)
mig(mach/lock_set.defs)
mig(mach/mach_host.defs)
mig(mach/mach_port.defs)
mig(mach/mach_vm.defs)
mig(mach/mach_voucher.defs)
mig(mach/notify.defs)
mig(mach/processor_set.defs)
mig(mach/processor.defs)
mig(mach/task.defs)
mig(mach/thread_act.defs)
mig(mach/vm_map.defs)

set(syscall_legacy_sources
	wrappers/legacy/accept.c
	wrappers/legacy/bind.c
	wrappers/legacy/connect.c
	wrappers/legacy/getattrlist.c
	wrappers/legacy/getaudit.c
	wrappers/legacy/getpeername.c
	wrappers/legacy/getsockname.c
	wrappers/legacy/kill.c
	wrappers/legacy/lchown.c
	wrappers/legacy/listen.c
	wrappers/legacy/mprotect.c
	wrappers/legacy/msync.c
	wrappers/legacy/munmap.c
	wrappers/legacy/open.c
	wrappers/legacy/recvfrom.c
	wrappers/legacy/recvmsg.c
	wrappers/legacy/select.c
	#wrappers/legacy/select-pre1050.c
	wrappers/legacy/sendmsg.c
	wrappers/legacy/sendto.c
	wrappers/legacy/setattrlist.c
	wrappers/legacy/sigsuspend.c
	wrappers/legacy/socketpair.c
	)

set(syscall_dynamic_sources
	wrappers/_libc_funcptr.c
	wrappers/_libkernel_init.c)

set(syscall_sources
	wrappers/libproc/libproc.c
	wrappers/libproc/proc_listpidspath.c

	#wrappers/coalition.c
	# wrappers/__commpage_gettimeofday.c
	#wrappers/csr.c
	wrappers/gethostuuid.c
	wrappers/getiopolicy_np.c
	#wrappers/guarded_open_dprotected_np.c
	#wrappers/guarded_open_np.c
	wrappers/init_cpu_capabilities.c
	wrappers/ioctl.c
	wrappers/mach_approximate_time.c
	wrappers/open_dprotected_np.c
	wrappers/posix_sem_obsolete.c
	wrappers/remove-counter.c
	wrappers/renameat.c
	wrappers/rename.c
	wrappers/rename_ext.c
	wrappers/rmdir.c
	#wrappers/select-base.c
	wrappers/setpriority.c
	#wrappers/sfi.c
	#wrappers/sigsuspend-base.c
	wrappers/unlinkat.c
	wrappers/unlink.c
	wrappers/kill.c
	
	#wrappers/legacy/select.c
	wrappers/legacy/select-pre1050.c
	
	wrappers/cancelable/fcntl.c
	wrappers/cancelable/fcntl-cancel.c
	wrappers/cancelable/select.c # defined in sys_x86-64/
	wrappers/cancelable/select-cancel.c
	wrappers/cancelable/sigsuspend.c
	wrappers/cancelable/sigsuspend-cancel.c
	
	wrappers/unix03/chmod.c
	wrappers/unix03/fchmod.c
	wrappers/unix03/getrlimit.c
	wrappers/unix03/mmap.c
	wrappers/unix03/munmap.c
	wrappers/unix03/setrlimit.c
	
	${syscall_legacy_sources}

	custom/errno.c
	#custom/var_errno.c
	
	# MIG generated files
	${CMAKE_CURRENT_BINARY_DIR}/mach/excUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/host_privUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/host_securityUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/ledgerUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/lock_setUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_hostUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_portUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_vmUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/mach_voucherUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/notifyUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/processor_setUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/processorUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/taskUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/thread_actUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/vm_mapUser.c
	${CMAKE_CURRENT_BINARY_DIR}/mach/clockUser.c
	
	mach/mach_init.c
	mach/clock_sleep.c
	mach/dylib_link.c
	mach/error_codes.c
	mach/exc_catcher.c
	mach/exc_catcher_state.c
	mach/exc_catcher_state_identity.c
	mach/fprintf_stderr.c
	mach/mach_error.c
	mach/mach_error_string.c
	mach/mach_init.c
	mach/mach_legacy.c
	mach/mach_msg.c
	mach/mach_port.c
	mach/mach_vm.c
	mach/mig_allocate.c
	mach/mig_deallocate.c
	mach/mig_reply_port.c
	mach/mig_reply_setup.c
	mach/mig_strncpy.c
	mach/ms_thread_switch.c
	mach/panic.c
	mach/port_obj.c
	mach/semaphore.c
	mach/slot_name.c
	mach/string.c
	mach/thread_act.c
)
if (BITS EQUAL 64)
set (syscall_sources ${syscall_sources}
	sys_x86-64/___accept_nocancel.S                                                                                                                                                                                                              
	sys_x86-64/___accept.S
	sys_x86-64/___access_extended.S
	sys_x86-64/_access.S
	sys_x86-64/_acct.S
	sys_x86-64/_adjtime.S
	sys_x86-64/_aio_cancel.S
	sys_x86-64/_aio_error.S
	sys_x86-64/_aio_fsync.S
	sys_x86-64/_aio_read.S
	sys_x86-64/_aio_return.S
	sys_x86-64/___aio_suspend_nocancel.S
	sys_x86-64/_aio_suspend.S
	sys_x86-64/_aio_write.S
	sys_x86-64/_auditctl.S
	sys_x86-64/_auditon.S
	sys_x86-64/_audit.S
	sys_x86-64/_audit_session_join.S
	sys_x86-64/_audit_session_port.S
	sys_x86-64/_audit_session_self.S
	sys_x86-64/___bind.S
	sys_x86-64/___bsdthread_create.S
	sys_x86-64/___bsdthread_ctl.S
	sys_x86-64/___bsdthread_register.S
	sys_x86-64/___bsdthread_terminate.S
	sys_x86-64/___close_nocancel.S
	sys_x86-64/_close.S
	sys_x86-64/___coalition_info.S
	sys_x86-64/___coalition.S
	sys_x86-64/___connect_nocancel.S
	sys_x86-64/___connect.S
	sys_x86-64/_connectx.S
	sys_x86-64/___copyfile.S
	sys_x86-64/_csops_audittoken.S
	sys_x86-64/_csops.S
	sys_x86-64/___csrctl.S
	sys_x86-64/custom.S
	sys_x86-64/___delete.S
	sys_x86-64/___disable_threadsignal.S
	sys_x86-64/_disconnectx.S
	sys_x86-64/_dup.S
	sys_x86-64/_dup2.S
	sys_x86-64/_execve.S
	sys_x86-64/_exchangedata.S
	sys_x86-64/___exit.S
	sys_x86-64/_faccessat.S
	sys_x86-64/___fcntl_nocancel.S
	sys_x86-64/___fcntl.S
	sys_x86-64/_fdatasync.S
	sys_x86-64/_ffsctl.S
	sys_x86-64/_fgetattrlist.S
	sys_x86-64/_fgetxattr.S
	sys_x86-64/_fhopen.S
	sys_x86-64/_fchdir.S
	sys_x86-64/_fchflags.S
	sys_x86-64/_fchmodat.S
	sys_x86-64/___fchmod_extended.S
	sys_x86-64/___fchmod.S
	sys_x86-64/_fchownat.S
	sys_x86-64/_fchown.S
	sys_x86-64/_fileport_makefd.S
	sys_x86-64/_fileport_makeport.S
	sys_x86-64/_flistxattr.S
	sys_x86-64/_flock.S
	sys_x86-64/___fork.S
	sys_x86-64/_fpathconf.S
	sys_x86-64/_fremovexattr.S
	sys_x86-64/_fsctl.S
	sys_x86-64/_fsetattrlist.S
	sys_x86-64/_fsetxattr.S
	sys_x86-64/___fsgetpath.S
	sys_x86-64/_fstatat.S
	sys_x86-64/_fstatat64.S
	sys_x86-64/___fstat_extended.S
	sys_x86-64/_fstatfs.S
	sys_x86-64/_fstatfs64.S
	sys_x86-64/_fstat.S
	sys_x86-64/___fstat64_extended.S
	sys_x86-64/_fstat64.S
	sys_x86-64/___fsync_nocancel.S
	sys_x86-64/_fsync.S
	sys_x86-64/_ftruncate.S
	sys_x86-64/_futimes.S
	sys_x86-64/_getattrlistat.S
	sys_x86-64/_getattrlistbulk.S
	sys_x86-64/___getattrlist.S
	sys_x86-64/_getaudit_addr.S
	sys_x86-64/_getauid.S
	sys_x86-64/_getdirentriesattr.S
	sys_x86-64/_getdirentries.S
	sys_x86-64/___getdirentries64.S
	sys_x86-64/_getdtablesize.S
	sys_x86-64/_getegid.S
	sys_x86-64/_geteuid.S
	sys_x86-64/_getfh.S
	sys_x86-64/_getfsstat.S
	sys_x86-64/_getfsstat64.S
	sys_x86-64/_getgid.S
	sys_x86-64/_getgroups.S
	sys_x86-64/___gethostuuid.S
	sys_x86-64/_getitimer.S
	sys_x86-64/___getlogin.S
	sys_x86-64/___getpeername.S
	sys_x86-64/_getpgid.S
	sys_x86-64/_getpgrp.S
	sys_x86-64/___getpid.S
	sys_x86-64/_getppid.S
	sys_x86-64/_getpriority.S
	sys_x86-64/___getrlimit.S
	sys_x86-64/_getrusage.S
	sys_x86-64/___getsgroups.S
	sys_x86-64/_getsid.S
	sys_x86-64/___getsockname.S
	sys_x86-64/_getsockopt.S
	sys_x86-64/___gettid.S
	sys_x86-64/___gettimeofday.S
	sys_x86-64/_getuid.S
	sys_x86-64/___getwgroups.S
	sys_x86-64/_getxattr.S
	sys_x86-64/_grab_pgo_data.S
	sys_x86-64/_guarded_close_np.S
	sys_x86-64/_guarded_kqueue_np.S
	sys_x86-64/___guarded_open_dprotected_np.S
	sys_x86-64/___guarded_open_np.S
	sys_x86-64/_guarded_pwrite_np.S
	sys_x86-64/_guarded_write_np.S
	sys_x86-64/_guarded_writev_np.S
	sys_x86-64/_change_fdguard_np.S
	sys_x86-64/_chdir.S
	sys_x86-64/_chflags.S
	sys_x86-64/___chmod_extended.S
	sys_x86-64/___chmod.S
	sys_x86-64/_chown.S
	sys_x86-64/_chroot.S
	sys_x86-64/___chud.S
	sys_x86-64/___identitysvc.S
	sys_x86-64/___initgroups.S
	sys_x86-64/___ioctl.S
	sys_x86-64/___iopolicysys.S
	sys_x86-64/_issetugid.S
	sys_x86-64/_kas_info.S
	sys_x86-64/___kdebug_trace.S
	sys_x86-64/___kdebug_trace_string.S
	sys_x86-64/___kdebug_trace64.S
	#sys_x86-64/_kevent_qos.S
	#sys_x86-64/_kevent.S
	#sys_x86-64/_kevent64.S
	sys_x86-64/___kill.S
	#sys_x86-64/_kqueue.S
	sys_x86-64/_ledger.S
	sys_x86-64/___lchown.S
	sys_x86-64/_linkat.S
	sys_x86-64/_link.S
	sys_x86-64/_lio_listio.S
	sys_x86-64/___listen.S
	sys_x86-64/_listxattr.S
	sys_x86-64/___lseek.S
	sys_x86-64/___lstat_extended.S
	sys_x86-64/_lstat.S
	sys_x86-64/___lstat64_extended.S
	sys_x86-64/_lstat64.S
	sys_x86-64/___mac_execve.S
	sys_x86-64/___mac_get_fd.S
	sys_x86-64/___mac_get_file.S
	sys_x86-64/___mac_getfsstat.S
	sys_x86-64/___mac_get_link.S
	sys_x86-64/___mac_get_mount.S
	sys_x86-64/___mac_get_pid.S
	sys_x86-64/___mac_get_proc.S
	sys_x86-64/___mac_mount.S
	sys_x86-64/___mac_set_fd.S
	sys_x86-64/___mac_set_file.S
	sys_x86-64/___mac_set_link.S
	sys_x86-64/___mac_set_proc.S
	sys_x86-64/___mac_syscall.S
	sys_x86-64/_madvise.S
	sys_x86-64/_memorystatus_control.S
	sys_x86-64/_memorystatus_get_level.S
	sys_x86-64/___microstackshot.S
	sys_x86-64/_mincore.S
	sys_x86-64/_minherit.S
	sys_x86-64/_mkdirat.S
	sys_x86-64/___mkdir_extended.S
	sys_x86-64/_mkdir.S
	sys_x86-64/___mkfifo_extended.S
	sys_x86-64/_mkfifo.S
	sys_x86-64/_mknod.S
	sys_x86-64/_mlockall.S
	sys_x86-64/_mlock.S
	sys_x86-64/___mmap.S
	sys_x86-64/_modwatch.S
	sys_x86-64/_mount.S
	sys_x86-64/___mprotect.S
	sys_x86-64/_mremap_encrypted.S
	sys_x86-64/___msgctl.S
	sys_x86-64/_msgget.S
	sys_x86-64/___msgrcv_nocancel.S
	sys_x86-64/_msgrcv.S
	sys_x86-64/___msgsnd_nocancel.S
	sys_x86-64/_msgsnd.S
	sys_x86-64/___msgsys.S
	sys_x86-64/___msync_nocancel.S
	sys_x86-64/___msync.S
	sys_x86-64/_munlockall.S
	sys_x86-64/_munlock.S
	sys_x86-64/___munmap.S
	sys_x86-64/_necp_match_policy.S
	sys_x86-64/_netagent_trigger.S
	sys_x86-64/_nfsclnt.S
	sys_x86-64/_nfssvc.S
	sys_x86-64/_____old_semwait_signal_nocancel.S
	sys_x86-64/___old_semwait_signal.S
	sys_x86-64/___openat_nocancel.S
	sys_x86-64/___openat.S
	sys_x86-64/_openbyid_np.S
	sys_x86-64/___open_dprotected_np.S
	sys_x86-64/___open_extended.S
	sys_x86-64/___open_nocancel.S
	sys_x86-64/___open.S
	sys_x86-64/_pathconf.S
	sys_x86-64/_peeloff.S
	sys_x86-64/___persona.S
	sys_x86-64/_pid_resume.S
	sys_x86-64/_pid_suspend.S
	sys_x86-64/___pipe.S
	sys_x86-64/___poll_nocancel.S
	sys_x86-64/_poll.S
	sys_x86-64/___posix_spawn.S
	sys_x86-64/___pread_nocancel.S
	sys_x86-64/_pread.S
	sys_x86-64/___process_policy.S
	sys_x86-64/___proc_info.S
	sys_x86-64/_proc_rlimit_control.S
	sys_x86-64/_proc_trace_log.S
	sys_x86-64/_proc_uuid_policy.S
	sys_x86-64/___pselect_nocancel.S
	sys_x86-64/___pselect.S
	sys_x86-64/___psynch_cvbroad.S
	sys_x86-64/___psynch_cvclrprepost.S
	sys_x86-64/___psynch_cvsignal.S
	sys_x86-64/___psynch_cvwait.S
	sys_x86-64/___psynch_mutexdrop.S
	sys_x86-64/___psynch_mutexwait.S
	sys_x86-64/___psynch_rw_downgrade.S
	sys_x86-64/___psynch_rw_longrdlock.S
	sys_x86-64/___psynch_rw_rdlock.S
	sys_x86-64/___psynch_rw_unlock.S
	sys_x86-64/___psynch_rw_unlock2.S
	sys_x86-64/___psynch_rw_upgrade.S
	sys_x86-64/___psynch_rw_wrlock.S
	sys_x86-64/___psynch_rw_yieldwrlock.S
	sys_x86-64/___pthread_canceled.S
	sys_x86-64/___pthread_fchdir.S
	sys_x86-64/___pthread_chdir.S
	sys_x86-64/___pthread_kill.S
	sys_x86-64/___pthread_markcancel.S
	sys_x86-64/___pthread_sigmask.S
	sys_x86-64/___ptrace.S
	sys_x86-64/___pwrite_nocancel.S
	sys_x86-64/_pwrite.S
	sys_x86-64/_quotactl.S
	sys_x86-64/_quota.S
	sys_x86-64/_readlinkat.S
	sys_x86-64/_readlink.S
	sys_x86-64/___read_nocancel.S
	sys_x86-64/_read.S
	sys_x86-64/___readv_nocancel.S
	sys_x86-64/_readv.S
	sys_x86-64/_reboot.S
	sys_x86-64/___recvfrom_nocancel.S
	sys_x86-64/___recvfrom.S
	sys_x86-64/___recvmsg_nocancel.S
	sys_x86-64/___recvmsg.S
	sys_x86-64/_recvmsg_x.S
	sys_x86-64/_removexattr.S
	sys_x86-64/___renameat.S
	sys_x86-64/___rename_ext.S
	sys_x86-64/___rename.S
	sys_x86-64/_revoke.S
	sys_x86-64/___rmdir.S
	sys_x86-64/_searchfs.S
	sys_x86-64/___select_nocancel.S
	sys_x86-64/___select.S
	sys_x86-64/_sem_close.S
	sys_x86-64/___semctl.S
	sys_x86-64/_semget.S
	sys_x86-64/___sem_open.S
	sys_x86-64/_semop.S
	sys_x86-64/_sem_post.S
	sys_x86-64/___semsys.S
	sys_x86-64/_sem_trywait.S
	sys_x86-64/_sem_unlink.S
	sys_x86-64/___sem_wait_nocancel.S
	sys_x86-64/_sem_wait.S
	sys_x86-64/___semwait_signal_nocancel.S
	sys_x86-64/___semwait_signal.S
	sys_x86-64/_sendfile.S
	sys_x86-64/___sendmsg_nocancel.S
	sys_x86-64/___sendmsg.S
	sys_x86-64/_sendmsg_x.S
	sys_x86-64/___sendto_nocancel.S
	sys_x86-64/___sendto.S
	sys_x86-64/___setattrlist.S
	sys_x86-64/_setaudit_addr.S
	sys_x86-64/_setauid.S
	sys_x86-64/_setegid.S
	sys_x86-64/_seteuid.S
	sys_x86-64/_setgid.S
	sys_x86-64/_setgroups.S
	sys_x86-64/_setitimer.S
	sys_x86-64/___setlogin.S
	sys_x86-64/_setpgid.S
	sys_x86-64/___setpriority.S
	sys_x86-64/_setprivexec.S
	sys_x86-64/_setquota.S
	sys_x86-64/___setregid.S
	sys_x86-64/___setreuid.S
	sys_x86-64/___setrlimit.S
	sys_x86-64/___setsgroups.S
	sys_x86-64/_setsid.S
	sys_x86-64/_setsockopt.S
	sys_x86-64/___settid.S
	sys_x86-64/___settid_with_pid.S
	sys_x86-64/___settimeofday.S
	sys_x86-64/_setuid.S
	sys_x86-64/___setwgroups.S
	sys_x86-64/_setxattr.S
	sys_x86-64/___sfi_ctl.S
	sys_x86-64/___sfi_pidctl.S
	sys_x86-64/___shared_region_check_np.S
	sys_x86-64/___shared_region_map_and_slide_np.S
	sys_x86-64/_shmat.S
	sys_x86-64/___shmctl.S
	sys_x86-64/_shmdt.S
	sys_x86-64/_shmget.S
	sys_x86-64/___shm_open.S
	sys_x86-64/___shmsys.S
	sys_x86-64/_shm_unlink.S
	sys_x86-64/_shutdown.S
	sys_x86-64/___sigaction.S
	sys_x86-64/___sigaltstack.S
	sys_x86-64/_sigpending.S
	sys_x86-64/_sigprocmask.S
	sys_x86-64/___sigreturn.S
	sys_x86-64/___sigsuspend_nocancel.S
	sys_x86-64/___sigsuspend.S
	sys_x86-64/_____sigwait_nocancel.S
	sys_x86-64/___sigwait.S
	sys_x86-64/_socket_delegate.S
	sys_x86-64/___socketpair.S
	sys_x86-64/_socket.S
	sys_x86-64/___stack_snapshot.S
	sys_x86-64/___stack_snapshot_with_config.S
	sys_x86-64/___stat_extended.S
	sys_x86-64/_statfs.S
	sys_x86-64/_statfs64.S
	sys_x86-64/_stat.S
	sys_x86-64/___stat64_extended.S
	sys_x86-64/_stat64.S
	sys_x86-64/_swapon.S
	sys_x86-64/_symlinkat.S
	sys_x86-64/_symlink.S
	sys_x86-64/_sync.S
	sys_x86-64/___syscall.S
	sys_x86-64/___sysctlbyname.S
	sys_x86-64/___sysctl.S
	sys_x86-64/_system_override.S
	sys_x86-64/___telemetry.S
	sys_x86-64/___thread_selfid.S
	sys_x86-64/___thread_selfusage.S
	sys_x86-64/_truncate.S
	sys_x86-64/___umask_extended.S
	sys_x86-64/_umask.S
	sys_x86-64/_undelete.S
	sys_x86-64/___unlinkat.S
	sys_x86-64/___unlink.S
	sys_x86-64/_unmount.S
	sys_x86-64/_usrctl.S
	sys_x86-64/_utimes.S
	sys_x86-64/___vfork.S
	sys_x86-64/_vfs_purge.S
	sys_x86-64/_vm_pressure_monitor.S
	sys_x86-64/_waitevent.S
	sys_x86-64/___waitid_nocancel.S
	sys_x86-64/_waitid.S
	sys_x86-64/___wait4_nocancel.S
	sys_x86-64/___wait4.S
	sys_x86-64/_watchevent.S
	sys_x86-64/___work_interval_ctl.S
	sys_x86-64/___workq_kernreturn.S
	sys_x86-64/___workq_open.S
	sys_x86-64/___write_nocancel.S
	sys_x86-64/_write.S
	sys_x86-64/___writev_nocancel.S
	sys_x86-64/_writev.S
)
elseif(BITS EQUAL 32)

set (syscall_sources ${syscall_sources}
	sys_i386/__accept_nocancel.S
	sys_i386/__accept.S
	sys_i386/__access_extended.S
	sys_i386/access.S
	sys_i386/acct.S
	sys_i386/adjtime.S
	sys_i386/aio_cancel.S
	sys_i386/aio_error.S
	sys_i386/aio_fsync.S
	sys_i386/aio_read.S
	sys_i386/aio_return.S
	sys_i386/__aio_suspend_nocancel.S
	sys_i386/aio_suspend.S
	sys_i386/aio_write.S
	sys_i386/auditctl.S
	sys_i386/auditon.S
	sys_i386/audit.S
	sys_i386/audit_session_join.S
	sys_i386/audit_session_port.S
	sys_i386/audit_session_self.S
	sys_i386/__bind.S
	sys_i386/__bsdthread_create.S
	sys_i386/__bsdthread_ctl.S
	sys_i386/__bsdthread_register.S
	sys_i386/__bsdthread_terminate.S
	sys_i386/change_fdguard_np.S
	sys_i386/chdir.S
	sys_i386/chflags.S
	sys_i386/__chmod_extended.S
	sys_i386/__chmod.S
	sys_i386/chown.S
	sys_i386/chroot.S
	sys_i386/__chud.S
	sys_i386/__close_nocancel.S
	sys_i386/close.S
	sys_i386/__coalition_info.S
	sys_i386/__coalition.S
	sys_i386/__connect_nocancel.S
	sys_i386/__connect.S
	sys_i386/connectx.S
	sys_i386/__copyfile.S
	sys_i386/csops_audittoken.S
	sys_i386/csops.S
	sys_i386/__csrctl.S
	sys_i386/custom.S
	sys_i386/__delete.S
	sys_i386/__disable_threadsignal.S
	sys_i386/disconnectx.S
	sys_i386/dup2.S
	sys_i386/dup.S
	sys_i386/exchangedata.S
	sys_i386/execve.S
	sys_i386/__exit.S
	sys_i386/faccessat.S
	sys_i386/fchdir.S
	sys_i386/fchflags.S
	sys_i386/fchmodat.S
	sys_i386/__fchmod_extended.S
	sys_i386/__fchmod.S
	sys_i386/fchownat.S
	sys_i386/fchown.S
	sys_i386/__fcntl_nocancel.S
	sys_i386/__fcntl.S
	sys_i386/fdatasync.S
	sys_i386/ffsctl.S
	sys_i386/fgetattrlist.S
	sys_i386/fgetxattr.S
	sys_i386/fhopen.S
	sys_i386/fileport_makefd.S
	sys_i386/fileport_makeport.S
	sys_i386/flistxattr.S
	sys_i386/flock.S
	sys_i386/__fork.S
	sys_i386/fpathconf.S
	sys_i386/fremovexattr.S
	sys_i386/fsctl.S
	sys_i386/fsetattrlist.S
	sys_i386/fsetxattr.S
	sys_i386/__fsgetpath.S
	sys_i386/__fstat64_extended.S
	sys_i386/fstat64.S
	sys_i386/fstatat64.S
	sys_i386/fstatat.S
	sys_i386/__fstat_extended.S
	sys_i386/fstatfs64.S
	sys_i386/fstatfs.S
	sys_i386/fstat.S
	sys_i386/__fsync_nocancel.S
	sys_i386/fsync.S
	sys_i386/ftruncate.S
	sys_i386/futimes.S
	sys_i386/getattrlistat.S
	sys_i386/getattrlistbulk.S
	sys_i386/__getattrlist.S
	sys_i386/getaudit_addr.S
	sys_i386/getauid.S
	sys_i386/__getdirentries64.S
	sys_i386/getdirentriesattr.S
	sys_i386/getdirentries.S
	sys_i386/getdtablesize.S
	sys_i386/getegid.S
	sys_i386/geteuid.S
	sys_i386/getfh.S
	sys_i386/getfsstat64.S
	sys_i386/getfsstat.S
	sys_i386/getgid.S
	sys_i386/getgroups.S
	sys_i386/__gethostuuid.S
	sys_i386/getitimer.S
	sys_i386/__getlcid.S
	sys_i386/__getlogin.S
	sys_i386/__getpeername.S
	sys_i386/getpgid.S
	sys_i386/getpgrp.S
	sys_i386/__getpid.S
	sys_i386/getppid.S
	sys_i386/getpriority.S
	sys_i386/__getrlimit.S
	sys_i386/getrusage.S
	sys_i386/__getsgroups.S
	sys_i386/getsid.S
	sys_i386/__getsockname.S
	sys_i386/getsockopt.S
	sys_i386/__gettid.S
	sys_i386/__gettimeofday.S
	sys_i386/getuid.S
	sys_i386/__getwgroups.S
	sys_i386/getxattr.S
	sys_i386/guarded_close_np.S
	sys_i386/guarded_kqueue_np.S
	sys_i386/__guarded_open_dprotected_np.S
	sys_i386/__guarded_open_np.S
	sys_i386/guarded_pwrite_np.S
	sys_i386/guarded_write_np.S
	sys_i386/guarded_writev_np.S
	sys_i386/__identitysvc.S
	sys_i386/__initgroups.S
	sys_i386/__ioctl.S
	sys_i386/__iopolicysys.S
	sys_i386/issetugid.S
	sys_i386/kas_info.S
	sys_i386/__kdebug_trace.S
	#sys_i386/kevent64.S
	#sys_i386/kevent.S
	sys_i386/__kill.S
	#sys_i386/kqueue.S
	sys_i386/__lchown.S
	sys_i386/ledger.S
	sys_i386/linkat.S
	sys_i386/link.S
	sys_i386/lio_listio.S
	sys_i386/__listen.S
	sys_i386/listxattr.S
	sys_i386/__lseek.S
	sys_i386/__lstat64_extended.S
	sys_i386/lstat64.S
	sys_i386/__lstat_extended.S
	sys_i386/lstat.S
	sys_i386/__mac_execve.S
	sys_i386/__mac_get_fd.S
	sys_i386/__mac_get_file.S
	sys_i386/__mac_getfsstat.S
	sys_i386/__mac_get_lcid.S
	sys_i386/__mac_get_lctx.S
	sys_i386/__mac_get_link.S
	sys_i386/__mac_get_mount.S
	sys_i386/__mac_get_pid.S
	sys_i386/__mac_get_proc.S
	sys_i386/__mac_mount.S
	sys_i386/__mac_set_fd.S
	sys_i386/__mac_set_file.S
	sys_i386/__mac_set_lctx.S
	sys_i386/__mac_set_link.S
	sys_i386/__mac_set_proc.S
	sys_i386/__mac_syscall.S
	sys_i386/madvise.S
	sys_i386/memorystatus_control.S
	sys_i386/memorystatus_get_level.S
	sys_i386/mincore.S
	sys_i386/minherit.S
	sys_i386/mkdirat.S
	sys_i386/__mkdir_extended.S
	sys_i386/mkdir.S
	sys_i386/__mkfifo_extended.S
	sys_i386/mkfifo.S
	sys_i386/mknod.S
	sys_i386/mlockall.S
	sys_i386/mlock.S
	sys_i386/__mmap.S
	sys_i386/modwatch.S
	sys_i386/mount.S
	sys_i386/__mprotect.S
	sys_i386/mremap_encrypted.S
	sys_i386/__msgctl.S
	sys_i386/msgget.S
	sys_i386/__msgrcv_nocancel.S
	sys_i386/msgrcv.S
	sys_i386/__msgsnd_nocancel.S
	sys_i386/msgsnd.S
	sys_i386/__msgsys.S
	sys_i386/__msync_nocancel.S
	sys_i386/__msync.S
	sys_i386/munlockall.S
	sys_i386/munlock.S
	sys_i386/__munmap.S
	sys_i386/necp_match_policy.S
	sys_i386/nfsclnt.S
	sys_i386/nfssvc.S
	sys_i386/____old_semwait_signal_nocancel.S
	sys_i386/__old_semwait_signal.S
	sys_i386/__openat_nocancel.S
	sys_i386/__openat.S
	sys_i386/openbyid_np.S
	sys_i386/__open_dprotected_np.S
	sys_i386/__open_extended.S
	sys_i386/__open_nocancel.S
	sys_i386/__open.S
	sys_i386/pathconf.S
	sys_i386/peeloff.S
	sys_i386/pid_resume.S
	sys_i386/pid_suspend.S
	sys_i386/__pipe.S
	sys_i386/__poll_nocancel.S
	sys_i386/poll.S
	sys_i386/__posix_spawn.S
	sys_i386/__pread_nocancel.S
	sys_i386/pread.S
	sys_i386/__process_policy.S
	sys_i386/__proc_info.S
	sys_i386/proc_rlimit_control.S
	sys_i386/proc_trace_log.S
	sys_i386/proc_uuid_policy.S
	sys_i386/__psynch_cvbroad.S
	sys_i386/__psynch_cvclrprepost.S
	sys_i386/__psynch_cvsignal.S
	sys_i386/__psynch_cvwait.S
	sys_i386/__psynch_mutexdrop.S
	sys_i386/__psynch_mutexwait.S
	sys_i386/__psynch_rw_downgrade.S
	sys_i386/__psynch_rw_longrdlock.S
	sys_i386/__psynch_rw_rdlock.S
	sys_i386/__psynch_rw_unlock2.S
	sys_i386/__psynch_rw_unlock.S
	sys_i386/__psynch_rw_upgrade.S
	sys_i386/__psynch_rw_wrlock.S
	sys_i386/__psynch_rw_yieldwrlock.S
	sys_i386/__pthread_canceled.S
	sys_i386/__pthread_chdir.S
	sys_i386/__pthread_fchdir.S
	sys_i386/__pthread_kill.S
	sys_i386/__pthread_markcancel.S
	sys_i386/__pthread_sigmask.S
	sys_i386/__ptrace.S
	sys_i386/__pwrite_nocancel.S
	sys_i386/pwrite.S
	sys_i386/quotactl.S
	sys_i386/quota.S
	sys_i386/readlinkat.S
	sys_i386/readlink.S
	sys_i386/__read_nocancel.S
	sys_i386/read.S
	sys_i386/__readv_nocancel.S
	sys_i386/readv.S
	sys_i386/reboot.S
	sys_i386/__recvfrom_nocancel.S
	sys_i386/__recvfrom.S
	sys_i386/__recvmsg_nocancel.S
	sys_i386/__recvmsg.S
	sys_i386/recvmsg_x.S
	sys_i386/removexattr.S
	sys_i386/__renameat.S
	sys_i386/__rename_ext.S
	sys_i386/__rename.S
	sys_i386/revoke.S
	sys_i386/__rmdir.S
	sys_i386/searchfs.S
	sys_i386/__select_nocancel.S
	sys_i386/__select.S
	sys_i386/sem_close.S
	sys_i386/__semctl.S
	sys_i386/semget.S
	sys_i386/__sem_open.S
	sys_i386/semop.S
	sys_i386/sem_post.S
	sys_i386/__semsys.S
	sys_i386/sem_trywait.S
	sys_i386/sem_unlink.S
	sys_i386/__sem_wait_nocancel.S
	sys_i386/sem_wait.S
	sys_i386/__semwait_signal_nocancel.S
	sys_i386/__semwait_signal.S
	sys_i386/sendfile.S
	sys_i386/__sendmsg_nocancel.S
	sys_i386/__sendmsg.S
	sys_i386/sendmsg_x.S
	sys_i386/__sendto_nocancel.S
	sys_i386/__sendto.S
	sys_i386/__setattrlist.S
	sys_i386/setaudit_addr.S
	sys_i386/setauid.S
	sys_i386/setegid.S
	sys_i386/seteuid.S
	sys_i386/setgid.S
	sys_i386/setgroups.S
	sys_i386/setitimer.S
	sys_i386/__setlcid.S
	sys_i386/__setlogin.S
	sys_i386/setpgid.S
	sys_i386/__setpriority.S
	sys_i386/setprivexec.S
	sys_i386/setquota.S
	sys_i386/__setregid.S
	sys_i386/__setreuid.S
	sys_i386/__setrlimit.S
	sys_i386/__setsgroups.S
	sys_i386/setsid.S
	sys_i386/setsockopt.S
	sys_i386/__settid.S
	sys_i386/__settid_with_pid.S
	sys_i386/__settimeofday.S
	sys_i386/setuid.S
	sys_i386/__setwgroups.S
	sys_i386/setxattr.S
	sys_i386/__sfi_ctl.S
	sys_i386/__sfi_pidctl.S
	sys_i386/__shared_region_check_np.S
	sys_i386/__shared_region_map_and_slide_np.S
	sys_i386/shmat.S
	sys_i386/__shmctl.S
	sys_i386/shmdt.S
	sys_i386/shmget.S
	sys_i386/__shm_open.S
	sys_i386/__shmsys.S
	sys_i386/shm_unlink.S
	sys_i386/shutdown.S
	sys_i386/__sigaction.S
	sys_i386/__sigaltstack.S
	sys_i386/sigpending.S
	sys_i386/sigprocmask.S
	sys_i386/__sigreturn.S
	sys_i386/__sigsuspend_nocancel.S
	sys_i386/__sigsuspend.S
	sys_i386/____sigwait_nocancel.S
	sys_i386/__sigwait.S
	sys_i386/socket_delegate.S
	sys_i386/__socketpair.S
	sys_i386/socket.S
	sys_i386/__stack_snapshot.S
	sys_i386/__stat64_extended.S
	sys_i386/stat64.S
	sys_i386/__stat_extended.S
	sys_i386/statfs64.S
	sys_i386/statfs.S
	sys_i386/stat.S
	sys_i386/swapon.S
	sys_i386/symlinkat.S
	sys_i386/symlink.S
	sys_i386/sync.S
	sys_i386/__syscall.S
	sys_i386/__sysctlbyname.S
	sys_i386/__sysctl.S
	sys_i386/system_override.S
	sys_i386/__telemetry.S
	sys_i386/__thread_selfid.S
	sys_i386/__thread_selfusage.S
	sys_i386/truncate.S
	sys_i386/__umask_extended.S
	sys_i386/umask.S
	sys_i386/undelete.S
	sys_i386/__unlinkat.S
	sys_i386/__unlink.S
	sys_i386/unmount.S
	sys_i386/utimes.S
	sys_i386/__vfork.S
	sys_i386/vfs_purge.S
	sys_i386/vm_pressure_monitor.S
	sys_i386/__wait4_nocancel.S
	sys_i386/__wait4.S
	sys_i386/waitevent.S
	sys_i386/__waitid_nocancel.S
	sys_i386/waitid.S
	sys_i386/watchevent.S
	sys_i386/__workq_kernreturn.S
	sys_i386/__workq_open.S
	sys_i386/__write_nocancel.S
	sys_i386/write.S
	sys_i386/__writev_nocancel.S
	sys_i386/writev.S
)
endif(BITS EQUAL 64)

mig(mach/clock.defs)
mig(mach/host_priv.defs)
mig(mach/host_security.defs)
mig(mach/ledger.defs)
mig(mach/lock_set.defs)
mig(mach/mach_host.defs)
mig(mach/mach_port.defs)
mig(mach/mach_vm.defs)
mig(mach/mach_voucher.defs)
mig(mach/notify.defs)
mig(mach/processor_set.defs)
mig(mach/processor.defs)
mig(mach/task.defs)
mig(mach/thread_act.defs)
mig(mach/vm_map.defs)

#set_source_files_properties(custom/errno.c PROPERTIES COMPILE_FLAGS "-no-integrated-as")
set_source_files_properties(${syscall_legacy_sources} PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0 -U__DARWIN_C_LEVEL")
set_source_files_properties(wrappers/legacy/select-pre1050.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE -DSYSCALL_PRE1050")
set_source_files_properties(wrappers/cancelable/select-cancel.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE")
set_source_files_properties(wrappers/cancelable/select.c PROPERTIES COMPILE_FLAGS "-U_DARWIN_C_SOURCE")

foreach (file IN ITEMS ${syscall_legacy_sources})
	set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${CMAKE_C_FLAGS} -U_DARWIN_C_SOURCE -U_POSIX_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0  -U__DARWIN_C_LEVEL")
endforeach(file)

add_library(libsyscall OBJECT ${syscall_sources})
add_library(libsyscall_dynamic OBJECT ${syscall_dynamic_sources})

add_library(libsyscall_static OBJECT wrappers/_libc_funcptr.c)
set_target_properties(libsyscall_static PROPERTIES COMPILE_FLAGS "-DVARIANT_DYLD")

# For i386
#add_library(libsyscall_legacy_extra OBJECT wrappers/legacy/select.c)
#set_target_properties(libsyscall_legacy_extra PROPERTIES COMPILE_FLAGS
#	"${CMAKE_C_FLAGS} -U_DARWIN_C_SOURCE -U_POSIX_C_SOURCE -U__DARWIN_UNIX03 -D__DARWIN_UNIX03=0 -U__DARWIN_C_LEVEL")



